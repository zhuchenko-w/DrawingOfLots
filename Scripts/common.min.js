var textAreaValueUpdating=false;var textAreaValueChanged=false;$(function(){$("#all-countries").on("change",function(){if($(this).is(":checked")){showValues(AllCountries)}});$("#all-states").on("change",function(){if($(this).is(":checked")){showValues(AllStates)}});$("#other").on("change",function(){if($(this).is(":checked")){showValues(null)}});$(".results").on("click",".btn-download-csv",function(){downloadCsv("Жеребьевка.csv",getResultCsvText())});$(".results").on("click",".btn-copy-all",function(){copyTextToClipboard($(".results .result-group"),getResultCsvText())});$(".results").on("click",".btn-copy-group",function(){var a=$(this).closest(".result-group");copyTextToClipboard(a,getResultGroupCsvText(a))});$(".start-btn").click(draw);$(".values").on("change input",function(){textAreaValueChanged=true;updateFilterAndIndicator(!textAreaValueUpdating)});$(".values").on("focusout",function(){if(textAreaValueChanged){textAreaValueChanged=false;updateFilterAndIndicator()}});createNumberOfGroupsOptions();initSelect2();showValues(AllCountries)});function initSelect2(){$(".multiselect").select2({language:"ru",width:"300px",allowClear:true,multiple:true,closeOnSelect:false,dropdownCssClass:"multiselect-dropdown",placeholder:"Все"}).on("select2:close",function(){if($(this).val().length>0){$(".values").prop("readonly",true)}else{$(".values").prop("readonly",false)}updateFilterAndIndicator(true)})}function createNumberOfGroupsOptions(){var a=1;while(a++<11){$(".number-of-groups").append($("<option value='"+a+"'"+(a==4?"selected":"")+">"+a+" штук"+(a>4?"":"и")+"</option>"))}}function updateFilterAndIndicator(a){var b=getDistinctValues();if(b.length==0){if(!a){setFilter(null)}$(".lines-count").text("");$(".start-btn").prop("disabled",true)}else{if(!a){setFilter(b)}$(".lines-count").text("("+b.length+") ");$(".start-btn").prop("disabled",false)}}function setFilter(b){$(".items-select option:not(.all-option)").remove();if(b!=null){var a="";$.each(b,function(c,d){a+="<option value='"+d+"'>"+d+"</option>"});$(".items-select").append($(a))}}function getDistinctValues(){return $(".values").prop("readonly")?$(".multiselect").val():distinct($(".values").val().split(/\r|\r\n|\n/).filter(function(a){return a.replace(/\s/g,"")!==""}))}function showValues(a){textAreaValueUpdating=true;var b=$(".values");b.prop("readonly",false);if(a==null){b.val("").change()}else{b.val(a.join("\n")).change()}textAreaValueUpdating=false}function getResultCsvText(){var b=$(".results .result-group");var a=[];$.each(b,function(c,d){a.push(getResultGroupCsvText(d))});return a.join("\r\n")}function getResultGroupCsvText(b){var c=$(".list-group-item",b);var a=[];$.each(c,function(d,e){a.push(e.innerText)});return a.join("\t")}function indicateCopyToClipboardResult(b,a){var c=a?"copied":"copy-error";b.removeClass("copied");b.removeClass("copy-error");b.addClass(c);setTimeout(function(){b.removeClass(c)},300)}function fallbackCopyTextToClipboard(a,e){var d=document.createElement("textarea");d.value=e;document.body.appendChild(d);d.focus();d.select();try{var c=document.execCommand("copy");indicateCopyToClipboardResult(a,c)}catch(b){indicateCopyToClipboardResult(a,false)}document.body.removeChild(d)}function copyTextToClipboard(a,b){if(!navigator.clipboard){fallbackCopyTextToClipboard(b);return}navigator.clipboard.writeText(b).then(function(){indicateCopyToClipboardResult(a,true)},function(c){indicateCopyToClipboardResult(a,false)})}function downloadCsv(a,e){var d="UTF-16LE";var g=[];var j;g.push(255,254);for(var f=0;f<e.length;f++){j=e.charCodeAt(f);g.push(j&255);g.push(j/256>>>0)}var b=new Blob([new Uint8Array(g)],{type:"text/csv;charset="+d+";"});if(navigator.msSaveBlob){navigator.msSaveBlob(b,a)}else{var c=URL.createObjectURL(b);var h=document.createElement("a");if(h.download!==undefined){h.setAttribute("href",c);h.setAttribute("download",a);h.style.visibility="hidden";document.body.appendChild(h);h.click();document.body.removeChild(h)}else{window.open(encodeURI(c))}}}function draw(){var g=getDistinctValues();var b=parseInt($(".number-of-groups").val());var c=$(".results");shuffle(g);var a=split(g,b);c.html("");if(a.length>0){c.append("<button type='button' class='btn btn-copy-all' title='Копировать все'></button>");c.append("<button type='button' class='btn btn-download-csv' title='Экспорт в CSV'></button>");var f,d;for(f=0;f<a.length;f++){var e="<div class='result-group col'><ul class='list-group'>";for(d=0;d<a[f].length;d++){e+="<li class='list-group-item'>"+a[f][d]+"</li>"}e+="</ul><button type='button' class='btn btn-copy-group' title='Копировать'></button></div>";c.append($(e))}}}function shuffle(b){var d,a,c;var e=b.length;for(d=0;d<e;d++){c=~~(Math.random()*e);a=b[d];b[d]=b[c];b[c]=a}return b}function split(c,b){var a=[];while(c.length){a.push(c.splice(0,b))}if(a.length>1&&$(".concat-remainder").is(":checked")&&a[a.length-1].length<b){a[a.length-2]=a[a.length-2].concat(a[a.length-1]);a.pop()}return a}function distinct(a){var b=[];$.each(a,function(c,e){var d=$.trim(e);if($.inArray(d,b)==-1){b.push(d)}});return b}const AllStates=["Айдахо","Айова","Алабама","Аляска","Аризона","Арканзас","Вайоминг","Вашингтон","Вермонт","Вирджиния","Висконсин","Гавайи","Делавэр","Джорджия","Западная Вирджиния","Иллинойс","Индиана","Калифорния","Канзас","Кентукки","Колорадо","Коннектикут","Луизиана","Массачусетс","Миннесота","Миссисипи","Миссури","Мичиган","Монтана","Мэн","Мэриленд","Небраска","Невада","Нью-Гэмпшир","Нью-Джерси","Нью-Йорк","Нью-Мексико","Огайо","Оклахома","Орегон","Пенсильвания","Род-Айленд","Северная Дакота","Северная Каролина","Теннесси","Техас","Флорида","Южная Дакота","Южная Каролина","Юта"];const AllCountries=["Афганистан","Австралия","Австрия","Азербайджан","Албания","Алжир","Ангола","Андорра","Антигуа и Барбуда","Аргентина","Армения","Багамы","Бангладеш","Барбадос","Бахрейн","Белиз","Белоруссия","Бельгия","Бенин","Бирма/Мьянма","Болгария","Боливия","Босния и Герцеговина","Ботсвана","Бразилия","Бруней","Буркина-Фасо","Бурунди","Бутан","Вануату","Ватикан","Венгрия","Венесуэла","Восточный Тимор","Вьетнам","Габон","Гаити","Гайана","Гамбия","Гана","Гватемала","Гвинея","Гвинея-Бисау","Германия","Гондурас","Гренада","Греция","Дания","Джибути","Джорджия","Доминика","Доминиканская Республика","Египет","Замбия","Западная Сахара","Зимбабве","Израиль","Индия","Индонезия","Иордания","Ирак","Иран","Ирландия","Исландия","Испания","Италия","Йемен","Кабо-Верде","Казахстан","Камбоджа","Камерун","Канада","Катар","Кения","Кипр","Кирибати","Китай","Колумбия","Коморские острова","Конго","Конго, демократическая республика","Корея, север","Корея, юг","Коста-Рика","Кот-д'Ивуар / Кот-д'Ивуар","Куба","Кувейт","Кыргызстан","Лаос","Латвия","Лесото","Либерия","Ливан","Ливия","Литва","Лихтенштейн","Люксембург","Маврикий","Мавритания","Мадагаскар","Македония","Малави","Малайзия","Мали","Мальдивы","Мальта","Марокко","Маршалловы Острова","Мексика","Микронезия","Мозамбик","Молдова","Монако","Монголия","Намибия","Науру","Непал","Нигер","Нигерия","Нидерланды","Никарагуа","Новая Зеландия","Норвегия","Объединенные Арабские Эмираты","Оман","Пакистан","Палау","Палестина","Панама","Папуа - Новая Гвинея","Парагвай","Перу","Польша","Португалия","Российская Федерация","Руанда","Румыния","Сальвадор","Самоа","Сан-Марино","Сан-Томе и Принсипи","Саудовская Аравия","Свазиленд","Сейшельские острова","Сенегал","Сент-Винсент и Гренадины","Сент-Китс и Невис","Сент-Люсия","Сербия","Сингапур","Сирия","Словакия","Словения","Соединенное Королевство","Соединенные Штаты","Соломоновы Острова","Сомали","Судан","Суринам","Сьерра-Леоне","Таджикистан","Таиланд","Танзания","Того","Тонга","Тринидад и Тобаго","Тувалу","Тунис","Туркмения","Турция","Уганда","Узбекистан","Украина","Уругвай","Фиджи","Филиппины","Финляндия","Франция","Хорватия","Центральноафриканская Республика","Чад","Черногория","Чешская Республика","Чили","Швейцария","Швеция","Шри-Ланка","Эквадор","Экваториальная Гвинея","Эритрея","Эстония","Эфиопия","Южная Африка","Южный Судан","Ямайка","Япония"];